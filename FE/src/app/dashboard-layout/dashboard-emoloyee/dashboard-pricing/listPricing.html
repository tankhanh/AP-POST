<div class="container mt-4">
  <h2 class="mb-4 fw-bold">üí∞ Danh s√°ch b·∫£ng gi√° d·ªãch v·ª•</h2>

  <!-- Filter Card -->
  <div class="card mb-4 p-3 shadow-sm">
    <form class="row g-3 align-items-end">

      <!-- Tr·∫°ng th√°i -->
      <div class="col-md-3">
        <label class="form-label d-block mb-1">Tr·∫°ng th√°i</label>
        <select class="form-select" [(ngModel)]="filters.isActive" name="isActive" (ngModelChange)="applyFilters()">
          <option value="">T·∫•t c·∫£</option>
          <option [value]="true">ƒêang √°p d·ª•ng</option>
          <option [value]="false">Kh√¥ng ho·∫°t ƒë·ªông</option>
        </select>
      </div>

      <!-- Gi√° t·ª´ -->
      <div class="col-md-2">
        <label class="form-label">Gi√° t·ª´</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="filters.minPrice"
          name="minPrice"
          (ngModelChange)="applyFilters()"
        />
      </div>

      <!-- Gi√° ƒë·∫øn -->
      <div class="col-md-2">
        <label class="form-label">Gi√° ƒë·∫øn</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="filters.maxPrice"
          name="maxPrice"
          (ngModelChange)="applyFilters()"
        />
      </div>

      <!-- T√¨m ki·∫øm theo t√™n d·ªãch v·ª• -->
      <div class="col-md-3">
        <label class="form-label">T√¨m ki·∫øm</label>
        <input
          type="text"
          class="form-control"
          placeholder="T√™n d·ªãch v·ª• / ID"
          [(ngModel)]="filters.search"
          name="search"
          (ngModelChange)="applyFilters()"
        />
      </div>

    </form>
  </div>

  <!-- Pricing Table -->
  <table class="table table-bordered table-hover align-middle text-center">
    <thead class="table-light">
      <tr>
        <th>D·ªãch v·ª•</th>
        <th>Gi√° c∆° b·∫£n</th>
        <th>Ng∆∞·ª°ng qu√° c√¢n</th>
        <th>Ph·ª• ph√≠ qu√° c√¢n</th>
        <th>Hi·ªáu l·ª±c t·ª´</th>
        <th>Hi·ªáu l·ª±c ƒë·∫øn</th>
        <th>Tr·∫°ng th√°i</th>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngFor="let p of pagedPrices()">
        <tr (click)="toggleExpand(p._id)" style="cursor: pointer">
          <td>{{ p.serviceId?.name || p.serviceId }}</td>
          <td>{{ p.basePrice | number }} ƒë</td>
          <td>{{ p.overweightThresholdKg }} kg</td>
          <td>{{ p.overweightFee | number }} ƒë</td>
          <td>{{ p.effectiveFrom | date : 'dd/MM/yyyy' }}</td>
          <td>{{ p.effectiveTo ? (p.effectiveTo | date:'dd/MM/yyyy') : 'Kh√¥ng c√≥' }}</td>

          <td>
            <span class="badge" [ngClass]="p.isActive ? 'bg-success' : 'bg-secondary'">
              {{ p.isActive ? 'ƒêang √°p d·ª•ng' : 'Kh√¥ng ho·∫°t ƒë·ªông' }}
            </span>
          </td>
        </tr>

        <!-- Chi ti·∫øt -->
        <tr *ngIf="expandedId === p._id">
          <td colspan="7">
            <div class="bg-dark text-white p-3 rounded-3">
              <h6 class="fw-bold text-warning mb-3">Chi ti·∫øt b·∫£ng gi√°</h6>

              <p><strong class="text-warning">ID:</strong> {{ p._id }}</p>
              <p><strong class="text-warning">D·ªãch v·ª•:</strong> {{ p.serviceId?.name || p.serviceId }}</p>

              <div class="row">
                <div class="col-md-6">
                  <p><strong class="text-warning">Gi√° c∆° b·∫£n:</strong> {{ p.basePrice | number }} ƒë</p>
                  <p><strong class="text-warning">Ng∆∞·ª°ng qu√° c√¢n:</strong> {{ p.overweightThresholdKg }} kg</p>
                </div>

                <div class="col-md-6">
                  <p><strong class="text-warning">Ph·ª• ph√≠ qu√° c√¢n:</strong> {{ p.overweightFee | number }} ƒë</p>
                  <p><strong class="text-warning">Hi·ªáu l·ª±c t·ª´:</strong> {{ p.effectiveFrom | date:'dd/MM/yyyy' }}</p>
                  <p><strong class="text-warning">Hi·ªáu l·ª±c ƒë·∫øn:</strong> 
                    {{ p.effectiveTo ? (p.effectiveTo | date:'dd/MM/yyyy') : 'Kh√¥ng c√≥' }}
                  </p>
                </div>
              </div>

              <p>
                <strong class="text-warning">Tr·∫°ng th√°i:</strong>
                <span class="badge" [ngClass]="p.isActive ? 'bg-success' : 'bg-secondary'">
                  {{ p.isActive ? 'ƒêang √°p d·ª•ng' : 'Kh√¥ng ho·∫°t ƒë·ªông' }}
                </span>
              </p>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <div *ngIf="filteredPrices.length === 0" class="alert alert-info text-center mt-3">
    Kh√¥ng t√¨m th·∫•y b·∫£ng gi√° n√†o.
  </div>

  <!-- Pagination -->
  <nav *ngIf="filteredPrices.length >= pageSize">
    <ul class="pagination justify-content-center mt-3">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="changePage(currentPage - 1)">Tr∆∞·ªõc</button>
      </li>

      <li
        class="page-item"
        *ngFor="let p of totalPages()"
        [class.active]="p === currentPage"
      >
        <button class="page-link" (click)="changePage(p)">{{ p }}</button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages().length">
        <button class="page-link" (click)="changePage(currentPage + 1)">Sau</button>
      </li>
    </ul>
  </nav>
</div>
