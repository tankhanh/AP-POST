<div class="container mt-4">
  <h2 class="mb-4 fw-bold">üè¢ Danh s√°ch chi nh√°nh / b∆∞u c·ª•c</h2>

  <!-- Filter Card -->
  <div class="card mb-4 p-3 shadow-sm">
    <form class="row g-3 align-items-end">
      <!-- T√¨m ki·∫øm -->
      <div class="col-md-4">
        <label class="form-label">T√¨m ki·∫øm</label>
        <input
          type="text"
          class="form-control"
          placeholder="M√£ chi nh√°nh / T√™n / ƒê·ªãa ch·ªâ"
          [(ngModel)]="filters.search"
          name="search"
          (ngModelChange)="applyFilters()"
        />
      </div>

      <!-- Tr·∫°ng th√°i -->
      <div class="col-md-3">
        <label class="form-label">Tr·∫°ng th√°i</label>
        <select
          class="form-select"
          [(ngModel)]="filters.isActive"
          name="isActive"
          (ngModelChange)="applyFilters()"
        >
          <option value="">T·∫•t c·∫£</option>
          <option [value]="true">Ho·∫°t ƒë·ªông</option>
          <option [value]="false">T·∫°m d·ª´ng</option>
        </select>
      </div>
    </form>
  </div>

  <!-- Branch Table -->
  <table class="table table-bordered table-hover align-middle text-center">
    <thead class="table-light">
      <tr>
        <th>M√£</th>
        <th>T√™n chi nh√°nh</th>
        <th>ƒê·ªãa ch·ªâ</th>
        <th>ƒêi·ªán tho·∫°i</th>
        <th>Tr·∫°ng th√°i</th>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngFor="let b of pagedBranches()">
        <tr (click)="toggleExpand(b._id)" style="cursor: pointer">
          <td>{{ b.code }}</td>
          <td>{{ b.name }}</td>
          <td>{{ b.address }}</td>
          <td>{{ b.phone }}</td>
          <td>
            <span class="badge" [ngClass]="b.isActive ? 'bg-success' : 'bg-secondary'">
              {{ b.isActive ? 'Ho·∫°t ƒë·ªông' : 'T·∫°m d·ª´ng' }}
            </span>
          </td>
        </tr>

        <!-- Expand Detail -->
        <tr *ngIf="expandedId === b._id">
          <td colspan="5">
            <div class="bg-dark text-white p-3 rounded-3">
              <h6 class="fw-bold text-warning mb-3">Chi ti·∫øt chi nh√°nh</h6>

              <p><strong class="text-warning">ID:</strong> {{ b._id }}</p>
              <p><strong class="text-warning">M√£:</strong> {{ b.code }}</p>
              <p><strong class="text-warning">T√™n:</strong> {{ b.name }}</p>
              <p><strong class="text-warning">ƒê·ªãa ch·ªâ:</strong> {{ b.address }}</p>

              <div class="row">
                <div class="col-md-6">
                  <p><strong class="text-warning">T·ªânh:</strong> {{ b.provinceName || '---' }}</p>
                  <p>
                    <strong class="text-warning">X√£/Ph∆∞·ªùng:</strong> {{ b.communeName || '---' }}
                  </p>
                </div>

                <div class="col-md-6">
                  <p><strong class="text-warning">ƒêi·ªán tho·∫°i:</strong> {{ b.phone }}</p>
                  <p>
                    <strong class="text-warning">Ng√†y t·∫°o:</strong>
                    {{ b.createdAt | date : 'dd/MM/yyyy' }}
                  </p>
                </div>
              </div>

              <div class="mt-2">
                <strong class="text-warning">Tr·∫°ng th√°i:</strong>
                <span class="badge" [ngClass]="b.isActive ? 'bg-success' : 'bg-secondary'">
                  {{ b.isActive ? 'Ho·∫°t ƒë·ªông' : 'T·∫°m d·ª´ng' }}
                </span>
              </div>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <div *ngIf="filteredBranches.length === 0" class="alert alert-info text-center mt-3">
    Kh√¥ng c√≥ chi nh√°nh n√†o.
  </div>

  <!-- Pagination -->
  <nav *ngIf="filteredBranches.length >= pageSize">
    <ul class="pagination justify-content-center mt-3">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="changePage(currentPage - 1)">Tr∆∞·ªõc</button>
      </li>

      <li class="page-item" *ngFor="let p of totalPages()" [class.active]="p === currentPage">
        <button class="page-link" (click)="changePage(p)">{{ p }}</button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages().length">
        <button class="page-link" (click)="changePage(currentPage + 1)">Sau</button>
      </li>
    </ul>
  </nav>
</div>
