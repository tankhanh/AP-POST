<div class="container mt-4">
  <h4 class="fw-bold mb-3">üßæ T·∫°o ƒë∆°n h√†ng m·ªõi</h4>

  <form [formGroup]="orderForm" (ngSubmit)="submit()">
    <div class="row g-4">
      <!-- C·ªôt b√™n tr√°i: Ng∆∞·ªùi g·ª≠i + Pickup -->
      <div class="col-md-6">
        <!-- Ng∆∞·ªùi g·ª≠i -->
        <div class="mb-3">
          <label class="form-label fw-semibold">Ng∆∞·ªùi g·ª≠i</label>
          <input type="text" class="form-control" formControlName="senderName" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi g·ª≠i" />
        </div>

        <!-- Pickup -->
        <div class="mb-3">
          <label class="form-label fw-semibold">ƒê·ªãa ch·ªâ l·∫•y h√†ng</label>

          <select class="form-select mb-2" formControlName="pickupProvinceId" (change)="onPickupProvinceChange()">
            <option value="">-- Ch·ªçn t·ªânh/th√†nh ph·ªë --</option>
            <option *ngFor="let p of provinces" [value]="p._id">{{ p.name }}</option>
          </select>

          <select class="form-select mb-2" formControlName="pickupCommuneId">
            <option value="">-- Ch·ªçn ph∆∞·ªùng/x√£ --</option>
            <option *ngFor="let c of pickupCommunes" [value]="c._id">{{ c.name }}</option>
          </select>

          <input type="text" class="form-control" formControlName="pickupDetailAddress" (input)="updatePickupMap()"
            placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ chi ti·∫øt" />

          <label class="form-label fw-semibold mt-3">üìç Ch·ªçn v·ªã tr√≠ l·∫•y h√†ng tr√™n b·∫£n ƒë·ªì</label>
          <app-map-picker #pickupMap (locationSelect)="setPickupLocation($event)"> </app-map-picker>
        </div>
      </div>

      <!-- C·ªôt b√™n ph·∫£i: Ng∆∞·ªùi nh·∫≠n + Delivery -->
      <div class="col-md-6">
        <!-- Ng∆∞·ªùi nh·∫≠n -->
        <div class="mb-3">
          <label class="form-label fw-semibold">Ng∆∞·ªùi nh·∫≠n</label>
          <input type="text" class="form-control" formControlName="receiverName" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi nh·∫≠n" />
        </div>

        <!-- SƒêT ng∆∞·ªùi nh·∫≠n -->
        <div class="mb-3">
          <label class="form-label fw-semibold">SƒêT ng∆∞·ªùi nh·∫≠n</label>
          <input type="text" class="form-control" formControlName="receiverPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" />
        </div>

        <!-- Delivery -->
        <div class="mb-3">
          <label class="form-label fw-semibold">ƒê·ªãa ch·ªâ giao h√†ng</label>

          <select class="form-select mb-2" formControlName="deliveryProvinceId" (change)="onDeliveryProvinceChange()">
            <option value="">-- Ch·ªçn t·ªânh/th√†nh ph·ªë --</option>
            <option *ngFor="let p of provinces" [value]="p._id">{{ p.name }}</option>
          </select>

          <select class="form-select mb-2" formControlName="deliveryCommuneId">
            <option value="">-- Ch·ªçn ph∆∞·ªùng/x√£ --</option>
            <option *ngFor="let c of deliveryCommunes" [value]="c._id">{{ c.name }}</option>
          </select>

          <input type="text" class="form-control" formControlName="deliveryDetailAddress"
            placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ chi ti·∫øt" />

          <label class="form-label fw-semibold mt-3">üìç Ch·ªçn v·ªã tr√≠ giao h√†ng tr√™n b·∫£n ƒë·ªì</label>
          <app-map-picker #deliveryMap (locationSelect)="setDeliveryLocation($event)">
          </app-map-picker>
        </div>
        <!-- D·ªãch v·ª• -->
        <div class="mb-3">
          <label class="form-label fw-semibold">D·ªãch v·ª•</label>
          <select class="form-select" formControlName="serviceCode">
            <option value="STD">Ti√™u chu·∫©n (r·∫ª h∆°n)</option>
            <option value="EXP">Nhanh (ƒë·∫Øt h∆°n)</option>
          </select>
        </div>

        <!-- C√¢n n·∫∑ng -->
        <div class="mb-3">
          <label class="form-label fw-semibold">Kh·ªëi l∆∞·ª£ng (kg)</label>
          <input type="number" step="0.1" min="0.01" class="form-control" formControlName="weightKg" placeholder="1">
        </div>

        <!-- Gi√° tr·ªã h√†ng h√≥a (COD) -->
        <div class="mb-3">
          <label class="form-label fw-semibold">Gi√° tr·ªã h√†ng h√≥a (VNƒê)</label>
          <input type="number" min="0" class="form-control" formControlName="codValue" placeholder="0">
        </div>

        <!-- K·∫øt qu·∫£ t·ª± ƒë·ªông t√≠nh -->
        <div class="alert alert-info mt-3">
          <strong>Ph√≠ v·∫≠n chuy·ªÉn: {{ shippingFee | number:'1.0-0' }} ‚Ç´</strong>
        </div>

        <div class="alert alert-success fs-4 fw-bold">
          T·ªïng ti·ªÅn kh√°ch tr·∫£: {{ totalPrice | number:'1.0-0' }} ‚Ç´
        </div>
      </div>

      <!-- Submit -->
      <div class="col-12 mt-3">
        <button class="btn btn-danger" [disabled]="loading || orderForm.invalid">
          <span *ngIf="!loading">T·∫°o ƒë∆°n h√†ng</span>
          <span *ngIf="loading" class="spinner-border spinner-border-sm"></span>
        </button>
      </div>
    </div>
  </form>
</div>